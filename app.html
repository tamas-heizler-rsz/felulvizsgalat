<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>Felülvizsgálat</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#000000">
  <link rel="manifest" href="manifest.json">

  <style>
    *, *::before, *::after { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 24px;
      font-family: system-ui, sans-serif;
      background: #000;
      color: #fff;
    }

    h1, h2 {
      text-align: center;
      margin-bottom: 16px;
    }

    section {
      max-width: 420px;
      margin: 0 auto;
    }

    .card {
      background: #fff;
      color: #000;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
      margin-bottom: 24px;
    }

    label {
      display: block;
      margin-bottom: 14px;
      font-size: 0.9rem;
      font-weight: 600;
    }

    input, select {
      width: 100%;
      padding: 12px;
      margin-top: 6px;
      font-size: 1rem;
      border-radius: 10px;
      border: 1px solid #ccc;
    }

    input:focus, select:focus {
      outline: 2px solid #FDC024;
      border-color: #FDC024;
    }

    .project-summary {
      margin-bottom: 2px;   /* kevesebb hely alatta */
      font-size: 1rem;
    }

    .primary-button {
      background: #FDC024;
      color: #000;
      border: none;
      border-radius: 14px;
      padding: 18px;
      font-size: 1.1rem;
      font-weight: 700;
      text-transform: uppercase;
      cursor: pointer;
      width: 100%;
    }

    .secondary-button {
      background: #FDC024;
      color: #000;
      border: none;
      border-radius: 10px;
      padding: 10px 16px;
      font-size: 0.85rem;
      font-weight: 600;
      text-transform: uppercase;
      cursor: pointer;
      margin-top: 12px;
    }

    .close-button {
      margin-top: 8px;
      margin-bottom: 24px; /* nagyobb üres hely a form előtt */
    }

    .issue {
      background: #f5f5f5;
      color: #000;
      padding: 12px;
      border-radius: 10px;
      margin-top: 10px;
      font-size: 0.9rem;
    }
    .number-control {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .number-control input {
      width: 80%;
      text-align: center;
    }

    .meretmegadas {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .step-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: none;
      background: #FDC024;
      color: #000;
      font-size: 20px;
      font-weight: bold;
    }

    .issue.zold {
      background: #d4edda;
      border-left: 6px solid #28a745;
    }

    .issue.sarga {
      background: #fff3cd;
      border-left: 6px solid #ffc107;
    }

    .issue.piros {
      background: #f8d7da;
      border-left: 6px solid #dc3545;
    }

  </style>
</head>

<body>

<h1>Felülvizsgálat</h1>

<!-- PROJEKT -->
<section id="step-project">
  <div class="card">
    <label>Ügyfél neve
      <input id="ugyfelNev" placeholder="pl. Cégnév Kft.">
    </label>

    <label>Helyszín
      <input id="helyszin" placeholder="pl. Budapest, Raktár utca 1.">
    </label>

    <label>Vizsgáló
      <input id="vizsgalo" placeholder="pl. Heizler Tamás" onclick="this.value=''" list="vizsgaloLista">
    </label>

    <label>Dátum
      <input type="date" id="datum">
    </label>

    <label>Kapcsolattartó
      <input id="kapcsolattarto" placeholder="pl. Gipsz Jakab">
    </label>

    <datalist id="vizsgaloLista">
      <option value="Kaszás Gergely">
      <option value="Gráff Péter">
      <option value="Heizler Tamás">
    </datalist>

    <button class="primary-button" id="toIssues">
      TOVÁBB
    </button>
  </div>
</section>

<!-- HIBALISTA -->
<section id="step-issues" style="display:none">

  <h2 id="projectSummary" class="project-summary"></h2>

  <button id="closeProject" class="primary-button close-button" type="button" style="margin-top:24px;">
    Felülvizsgálat vége
  </button>

  <div class="card">
    <label>Tárhelyazonosító
      <input id="hibaTA" placeholder="pl. A-0101">
    </label>

    <label>Sor
    <div class="number-control">
    <button type="button" class="step-btn" data-target="hibaSor" data-step="-1" tabindex="-1">−</button>
    <input id="hibaSor" placeholder="pl. 1. sor" step="1" tabindex="-1">
    <button type="button" class="step-btn" data-target="hibaSor" data-step="1">+</button>
    </div>
    </label>

    <label>Szint
    <div class="number-control">
    <button type="button" class="step-btn" data-target="hibaSzint" data-step="-1" tabindex="-1">−</button>
    <input id="hibaSzint" placeholder="pl. 2. szint" type="number" step="1" tabindex="-1" min="1" inputmode="numeric">
    <button type="button" class="step-btn" data-target="hibaSzint" data-step="1">+</button>
    </div>
    </label>

    <label>Gyártó
      <input id="hibaGyarto" placeholder="pl. Jungheinrich" onclick="this.value=''" list="gyartoLista">
    </label>

    <label>Alkatrész
      <select id="hibaAlkatresz">
        <option>Talplemez/Talpcsavar</option>
        <option>Állványláb</option>
        <option>Protektor</option>
        <option>Keretösszekötő</option>
        <option>Tartógerenda</option>
        <option>Túltolásgátló</option>
        <option>Biztosítószeg</option>
        <option>Egyéb</option>
      </select>
    </label>

    <label id="EHLabel" style="display:none;">
      Első vagy hátsó
      <select id="hibaEH">
        <option selected>Első</option>
        <option>Hátsó</option>
      </select>
    </label>

    <label id="JCSLabel" style="display:none;">
      Javítás vagy csere
      <select id="hibaJCS">
        <option>Javítás</option>
        <option selected>Csere</option>
      </select>
    </label>

    <label id="meretLabel" style="display:none;">Méret
    <div class = "meretmegadas">
    <input id="hibaMeretHossz" type="number" placeholder="hosszúság">
    <input id="hibaMeretMag" type="number" placeholder="magaság">
    <input id="hibaMeretSzel" type="number" placeholder="szélesség" >
    <input id="hibaMeretVast" type="number" placeholder="vastagság" >
    </div>
    </label>

    <label>Sérülési osztály
      <select id="hibaSO">
        <option>Zöld</option>
        <option selected>Sárga</option>
        <option>Piros</option>
      </select>
    </label>

    <label>Megjegyzés
      <input id="hibaMegj" placeholder="pl. egyedi színű az alkatrész">
    </label>

    <datalist id="gyartoLista">
      <option value="Jungheinrich">
      <option value="Dexion">
      <option value="STOW">
      <option value="Galler">
    </datalist>

    <button class="secondary-button" id="addIssue" type="button">
      HIBA HOZZÁADÁSA
    </button>
  </div>

  <div id="issueList"></div>


</section>

<script>
  let project = {
    meta: {},
    hibak: []
  };

//feltételes megjelenítés
const alkatreszSelect = document.getElementById('hibaAlkatresz');
    const ehLabel = document.getElementById('EHLabel');
    const jcsLabel = document.getElementById('JCSLabel');
    const meretLabel = document.getElementById('meretLabel');

    const ehRequired = [
      'Állványláb',
      'Tartógerenda'
    ];
    const jcsRequired = [
      'Tartógerenda',
      'Túltolásgátló'
    ];
    const meretRequired = [
      'Állványláb',
      'Protektor',
      'Keretösszekötő',
      'Tartógerenda',
      'Túltolásgátló'
    ];
    const meretHosszRequired = [
      'Keretösszekötő',
      'Tartógerenda',
      'Túltolásgátló'
    ];
    const meretMagRequired = [
      'Állványláb',
      'Protektor',
      'Tartógerenda',
    ];
    const meretSzelRequired = [
      'Állványláb',
      'Protektor',
      'Keretösszekötő',
      'Tartógerenda',
    ];
    const meretVastRequired = [
      'Állványláb',
    ];

    alkatreszSelect.addEventListener('change', () => {
      if (ehRequired.includes(alkatreszSelect.value)) {
        ehLabel.style.display = 'block';
      } else {
        ehLabel.style.display = 'none';
        document.getElementById('hibaEH').value = '';
      }
      if (jcsRequired.includes(alkatreszSelect.value)) {
        jcsLabel.style.display = 'block';
      } else {
        jcsLabel.style.display = 'none';
        document.getElementById('hibaJCS').value = '';
      }
      if (meretRequired.includes(alkatreszSelect.value)) {
        meretLabel.style.display = 'block';
        if (meretHosszRequired.includes(alkatreszSelect.value)) {
          hibaMeretHossz.style.display = 'block';
        }
        else {hibaMeretHossz.style.display = 'none';}
        if (meretMagRequired.includes(alkatreszSelect.value)) {
          hibaMeretMag.style.display = 'block';
        }
        else {hibaMeretMag.style.display = 'none';}
        if (meretSzelRequired.includes(alkatreszSelect.value)) {
          hibaMeretSzel.style.display = 'block';
        }
        else {hibaMeretSzel.style.display = 'none';}
        if (meretVastRequired.includes(alkatreszSelect.value)) {
          hibaMeretVast.style.display = 'block';
        }
        else {hibaMeretVast.style.display = 'none';}

      } else {
        meretLabel.style.display = 'none';
        document.getElementById('hibaMeretMag').value = '';
        document.getElementById('hibaMeretHossz').value = '';
        document.getElementById('hibaMeretSzel').value = '';
        document.getElementById('hibaMeretVast').value = '';
      }
    });
    //feltételes megjelenítés vége

  const save = () =>
    localStorage.setItem('currentProject', JSON.stringify(project));

  const load = () => {
    const data = localStorage.getItem('currentProject');
    if (data) project = JSON.parse(data);
  };

  const datumInput = document.getElementById('datum');
  datumInput.value = new Date().toISOString().split('T')[0];

  load();

  if (project.meta.ugyfelNev) {
    Object.keys(project.meta).forEach(k => {
      const el = document.getElementById(k);
      if (el) el.value = project.meta[k];
    });
    showIssues();
  }

  document.getElementById('toIssues').onclick = () => {
    project.meta = {
      ugyfelNev: ugyfelNev.value,
      helyszin: helyszin.value,
      vizsgalo: vizsgalo.value,
      datum: datum.value,
      kapcsolattarto: kapcsolattarto.value
    };
    save();
    showIssues();
  };

  //léptető
  document.querySelectorAll('.step-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const input = document.getElementById(btn.dataset.target);
      const step = Number(btn.dataset.step);
      let value = input.value.trim();

    // ÜRES → 0
      if (value === '') {
        input.value = Math.max(0, step);
        input.focus();
        return;
      }

      // Ha szám
      if (/^\d+$/.test(value)) {
        let num = parseInt(value, 10) + step;
        if (num < 0) num = 0;
        input.value = num;
      }

      // Ha egyetlen betű (A–Z vagy a–z)
      else if (/^[a-zA-Z]$/.test(value)) {
        let code = value.charCodeAt(0) + step;

        // nagybetűk
        if (value >= 'A' && value <= 'Z') {
          if (code < 65) code = 90;
          if (code > 90) code = 65;
        }

        // kisbetűk
        if (value >= 'a' && value <= 'z') {
          if (code < 97) code = 122;
          if (code > 122) code = 97;
        }

        input.value = String.fromCharCode(code);
      }

      input.focus();
    });
  });
  //léptető vége

  function showIssues() {
    document.getElementById('step-project').style.display = 'none';
    document.getElementById('step-issues').style.display = 'block';

    projectSummary.innerHTML =
      `${project.meta.ugyfelNev}<br>${project.meta.helyszin}<br>${project.meta.datum}<br>${project.meta.vizsgalo}`;

    renderIssues();
  }

  document.getElementById('addIssue').onclick = () => {
    project.hibak.push({
      tarhelyazonosito: hibaTA.value,
      sor: hibaSor.value,
      szint: hibaSzint.value,
      gyarto: hibaGyarto.value,
      alkatresz: hibaAlkatresz.value,
      elsohatso: hibaEH.value,
      javitascsere: hibaJCS.value,
      meretMag: hibaMeretMag.value,
      meretHossz: hibaMeretHossz.value,
      meretSzel: hibaMeretSzel.value,
      meretVast: hibaMeretVast.value,
      serulesiO: hibaSO.value,
      megjegyzes: hibaMegj.value
    });
    //visszaállítás alapértékre
    hibaTA.value = '';
    //hibaSor.value = '';
    hibaSzint.value='1';
    //hibaGyarto.value='';
    hibaAlkatresz.value='';
    hibaEH.value='Első';
    hibaJCS.value='Csere';
    hibaSO.value='Sárga';
    hibaMegj.value='';
    hibaMeretHossz.value='';
    hibaMeretMag.value='';
    hibaMeretSzel.value='';
    hibaMeretVast.value='';
    save();
    renderIssues();
  };

  //ugrás a következő input mezőre
  document.getElementById('hibaGyarto').addEventListener('change', () => {
  document.getElementById('hibaAlkatresz').focus();
  });
  document.getElementById('addIssue').addEventListener('click', () => {
  document.getElementById('hibaTA').focus();
  });

  document.getElementById('ugyfelNev').addEventListener('change', () => {
  document.getElementById('helyszin').focus();
  });
  document.getElementById('helyszin').addEventListener('change', () => {
  document.getElementById('vizsgalo').focus();
  });
  document.getElementById('vizsgalo').addEventListener('change', () => {
  document.getElementById('kapcsolattarto').focus();
  });
  document.getElementById('datum').addEventListener('change', () => {
  document.getElementById('kapcsolattarto').focus();
  });
  document.getElementById('kapcsolattarto').addEventListener('change', () => {
    document.getElementById('toIssues').focus();
  });

  function renderIssues() {
    issueList.innerHTML = '';
    project.hibak.forEach((h, i) => {
      issueList.innerHTML += `
        <div class="issue ${severityClass(h.serulesiO)}">
          <b>${i + 1}. hiba</b> ${h.tarhelyazonosito}<br>
          sor: ${h.sor}, szint: ${h.szint}<br>
          gyártó: ${h.gyarto}<br>
          alkatrész: ${h.alkatresz}<br>
          első/hátsó: ${h.elsohatso}<br>
          javítás/csere: ${h.javitascsere}<br>
          méret: ${h.meretHossz}x${h.meretMag}x${h.meretSzel}x${h.meretVast}<br>
          ${h.serulesiO}
        </div>`;
    });
  }

  function severityClass(s) {
    if (s === 'Zöld') return 'zold';
    if (s === 'Sárga') return 'sarga';
    if (s === 'Piros') return 'piros';
    return '';
  }

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
  }

  document.getElementById('closeProject').onclick = () => {
  // jelöld lezártnak
  project.closedAt = new Date().toISOString();

  // fájl export (később itt lesz PDF)
  const blob = new Blob(
    [JSON.stringify(project, null, 2)],
    { type: 'application/json' }
  );

  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'projekt_' + project.meta.ugyfelNev.replace(/\s+/g, '_') + '.json';
  a.click();

  // HIBALISTA TÖRLÉSE
  project = {
    meta: {},
    hibak: []
  };

  // törlés az aktív munkából
  localStorage.removeItem('currentProject');

// UI vissza alapállapotba
  document.getElementById('issueList').innerHTML = '';
  document.getElementById('step-issues').style.display = 'none';
  document.getElementById('step-project').style.display = 'block';

  ugyfelNev.value = '';
  helyszin.value = '';
  kapcsolattarto.value = '';

  alert('Felülvizsgálat anyaga letöltve.');

};

</script>

</body>
</html>
